{#
    Shadcn UI form theme for Symfony Forms.
    Automatically registered via SFUIToolboxExtension.
#}

{%- block form_widget_simple -%}
    {%- if type is defined and type == 'hidden' -%}
        <input type="hidden" {{ block('widget_attributes') }}{% if value is not empty %} value="{{ value }}"{% endif %} />
    {%- else -%}
        {%- set _cls = 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50' -%}
        {%- if errors|length > 0 -%}{%- set _cls = _cls ~ ' border-destructive focus-visible:ring-destructive' -%}{%- endif -%}
        {%- set attr = attr|merge({class: (_cls ~ ' ' ~ attr.class|default(''))|trim}) -%}
        <input {{ block('widget_attributes') }}{% if value is not empty %} value="{{ value }}"{% endif %} />
    {%- endif -%}
{%- endblock form_widget_simple -%}

{%- block textarea_widget -%}
    {%- set _cls = 'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50' -%}
    {%- if errors|length > 0 -%}{%- set _cls = _cls ~ ' border-destructive focus-visible:ring-destructive' -%}{%- endif -%}
    {%- set attr = attr|merge({class: (_cls ~ ' ' ~ attr.class|default(''))|trim}) -%}
    <textarea {{ block('widget_attributes') }}>{{ value }}</textarea>
{%- endblock textarea_widget -%}

{%- block choice_widget_collapsed -%}
    {%- if multiple -%}
        {%- set attr = attr|merge({size: attr.size|default(max(choices|length, 1))}) -%}
    {%- endif -%}
    {%- set _cls = 'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50' -%}
    {%- if errors|length > 0 -%}{%- set _cls = _cls ~ ' border-destructive focus:ring-destructive' -%}{%- endif -%}
    {%- set attr = attr|merge({class: (_cls ~ ' ' ~ attr.class|default(''))|trim}) -%}
    <select {{ block('widget_attributes') }}{% if multiple %} multiple="multiple"{% endif %}>
        {%- if placeholder is not none -%}
            <option value=""{% if required and value is empty %} selected="selected"{% endif %}>{{ placeholder != '' ? (translation_domain is same as(false) ? placeholder : placeholder|trans({}, translation_domain)) }}</option>
        {%- endif -%}
        {%- if preferred_choices|length > 0 -%}
            {%- set options = preferred_choices -%}
            {%- set render_preferred_choices = true -%}
            {{- block('choice_widget_options') -}}
            {%- if choices|length > 0 and separator is not none -%}
                <option disabled="disabled">{{ separator }}</option>
            {%- endif -%}
        {%- endif -%}
        {%- set options = choices -%}
        {%- set render_preferred_choices = false -%}
        {{- block('choice_widget_options') -}}
    </select>
{%- endblock choice_widget_collapsed -%}

{%- block checkbox_widget -%}
    {%- set attr = attr|merge({class: ('peer size-4 shrink-0 inline-block align-middle accent-primary rounded border-input disabled:cursor-not-allowed disabled:opacity-50 ' ~ attr.class|default(''))|trim}) -%}
    <input type="checkbox" {{ block('widget_attributes') }}{% if value is defined %} value="{{ value }}"{% endif %}{% if checked %} checked="checked"{% endif %} />
{%- endblock checkbox_widget -%}

{%- block radio_widget -%}
    {%- set attr = attr|merge({class: ('peer size-4 shrink-0 inline-block align-middle accent-primary border-input disabled:cursor-not-allowed disabled:opacity-50 ' ~ attr.class|default(''))|trim}) -%}
    <input type="radio" {{ block('widget_attributes') }}{% if value is defined %} value="{{ value }}"{% endif %}{% if checked %} checked="checked"{% endif %} />
{%- endblock radio_widget -%}

{%- block file_widget -%}
    {%- set attr = attr|merge({class: ('flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ' ~ attr.class|default(''))|trim}) -%}
    <input type="file" {{ block('widget_attributes') }} />
{%- endblock file_widget -%}

{%- block form_label -%}
    {%- if label is not same as(false) -%}
        {%- if not compound -%}
            {%- set label_attr = label_attr|merge({'for': id}) -%}
        {%- endif -%}
        {%- set label_attr = label_attr|merge({class: ('text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ' ~ label_attr.class|default(''))|trim}) -%}
        {%- if translation_domain is same as(false) -%}
            {%- set _label = label_html is same as(false) ? label : label|raw -%}
        {%- else -%}
            {%- set _label = label_html is same as(false) ? label|trans({}, translation_domain) : label|trans({}, translation_domain)|raw -%}
        {%- endif -%}
        <label{% for k, v in label_attr %} {{ k }}="{{ v }}"{% endfor %}>
            {{- _label is not empty ? _label : name|humanize -}}
            {%- if required %}<span class="ml-0.5 text-destructive" aria-hidden="true">*</span>{%- endif -%}
        </label>
    {%- endif -%}
{%- endblock form_label -%}

{%- block form_errors -%}
    {%- if errors|length > 0 -%}
        <div class="text-destructive text-sm font-normal" role="alert">
            {%- if errors|length == 1 -%}
                {{ errors[0].message }}
            {%- else -%}
                <ul class="ml-4 flex list-disc flex-col gap-1">
                    {%- for error in errors -%}<li>{{ error.message }}</li>{%- endfor -%}
                </ul>
            {%- endif -%}
        </div>
    {%- endif -%}
{%- endblock form_errors -%}

{%- block form_help -%}
    {%- if help is not empty -%}
        <p id="{{ id }}_help" class="text-muted-foreground text-sm">
            {%- if translation_domain is same as(false) -%}
                {{- help_html is same as(false) ? help : help|raw -}}
            {%- else -%}
                {{- help_html is same as(false) ? help|trans(help_translation_parameters, translation_domain) : help|trans(help_translation_parameters, translation_domain)|raw -}}
            {%- endif -%}
        </p>
    {%- endif -%}
{%- endblock form_help -%}

{%- block form_row -%}
    <div class="space-y-2">
        {{- form_label(form) -}}
        {{- form_widget(form) -}}
        {{- form_help(form) -}}
        {{- form_errors(form) -}}
    </div>
{%- endblock form_row -%}

{%- block checkbox_row -%}
    <div class="flex items-start gap-2">
        {{- form_widget(form) -}}
        <div class="space-y-1 leading-none">
            {{- form_label(form) -}}
            {{- form_help(form) -}}
            {{- form_errors(form) -}}
        </div>
    </div>
{%- endblock checkbox_row -%}

{%- block choice_widget_expanded -%}
    <div {{ block('widget_container_attributes') }}>
        {%- for child in form %}
            <div class="flex items-center gap-2">
                {{- form_widget(child) -}}
                {{- form_label(child, null, {label_attr: {class: 'font-normal cursor-pointer'}}) -}}
            </div>
        {% endfor -%}
    </div>
{%- endblock choice_widget_expanded -%}
